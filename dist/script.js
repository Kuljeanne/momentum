(()=>{"use strict";(()=>{const e=[{title:"Aqua Caelestis",src:"../src/sounds/Aqua Caelestis.mp3",duration:"00:39"},{title:"River Flows In You",src:"../src/sounds/River Flows In You.mp3",duration:"01:37"},{title:"Ennio Morricone",src:"../src/sounds/Ennio Morricone.mp3",duration:"01:37"},{title:"Summer Wind",src:"../src/sounds/Summer Wind.mp3",duration:"01:50"}];localStorage.getItem("lang")||localStorage.setItem("lang","en"),localStorage.getItem("photoSourse")||localStorage.setItem("photoSourse","github"),localStorage.getItem("blocks")||localStorage.setItem("blocks","time,date,greeting,quote,weather,audio,links");const t=document.querySelector(".time"),o=document.querySelector(".date");!function e(){const n=(new Date).toLocaleTimeString();t.textContent=n,function(){const e=new Date;let t="ru"===localStorage.getItem("lang")?"ru-RU":"en-US";const n=e.toLocaleDateString(t,{weekday:"long",month:"long",day:"numeric"});o.textContent=n}(),setTimeout(e,1e3)}();const n=document.querySelector(".greeting-container"),r=n.querySelector(".greeting");function l(){if("ru"===localStorage.getItem("lang"))r.textContent=function(){const e=(new Date).getHours();return e>=6&&e<12?"Доброе утро,":e>=12&&e<18?"Добрый день,":e>=18&&e<=23?"Добрый вечер,":"Доброй ночи"}();else{const e=c();r.textContent=`Good ${e},`}}function c(){const e=(new Date).getHours();return e>=6&&e<12?"morning":e>=12&&e<18?"afternoon":e>=18&&e<=23?"evening":"night"}l();const a=n.querySelector(".name");window.addEventListener("beforeunload",(function(){localStorage.setItem("name",a.value)})),window.addEventListener("load",(function(){localStorage.getItem("name")&&(a.value=localStorage.getItem("name"))}));const s=document.querySelector("body");let i=d(20,1);function u(){const e=new Image;let t=c(),o=i.toString().padStart(2,"0");e.src=`https://raw.githubusercontent.com/kuljeanne/stage1-tasks/assets/images/${t}/${o}.jpg`,e.onload=()=>{s.style.backgroundImage=`url(${e.src})`}}function d(e,t){return Math.floor(Math.random()*(e-t+1)+t)}const g=s.querySelector(".slide-prev"),m=s.querySelector(".slide-next");function S(){"unsplash"===localStorage.getItem("photoSourse")?y():"flickr"===localStorage.getItem("photoSourse")?h():u()}async function y(){const e=new Image;let t=`https://api.unsplash.com/photos/random?orientation=landscape&query=${document.querySelector("#tag").value?document.querySelector("#tag").value:c()}&client_id=8fg8aQ8yLdG18_c91M1RIF_f1CtnxmhlO625pT61igA`,o=await fetch(t),n=await o.json();e.src=`${n.urls.regular}`,e.onload=()=>{s.style.backgroundImage=`url(${e.src})`}}async function h(){const e=new Image;let t=`https://www.flickr.com/services/rest/?method=flickr.photos.search&api_key=cbb779b4af280f2b223288bae40b36f7&tags=${document.querySelector("#tag").value?document.querySelector("#tag").value:c()}&extras=url_l&format=json&nojsoncallback=1`,o=await fetch(t),n=await o.json(),r=d(n.photos.photo.length,1);e.src=`${n.photos.photo[r].url_l}`,e.onload=()=>{s.style.backgroundImage=`url(${e.src})`}}g.addEventListener("click",(function(){i--,i<1&&(i=20),u()})),m.addEventListener("click",(function(){"unsplash"===localStorage.getItem("photoSourse")?y():"flickr"===localStorage.getItem("photoSourse")?h():(i++,i>20&&(i=1),u())})),S();const p=s.querySelector(".weather-icon"),q=s.querySelector(".temperature"),f=s.querySelector(".weather-description"),v=s.querySelector(".wind"),k=s.querySelector(".humidity"),_=s.querySelector(".city");function b(){localStorage.setItem("city",_.value)}function w(){localStorage.getItem("city")&&(_.value=localStorage.getItem("city"))}async function x(){w();const e=`https://api.openweathermap.org/data/2.5/weather?q=${_.value}&lang=${localStorage.getItem("lang")}&appid=6adf52378471885747632e28adc308bf&units=metric`,t=await fetch(e),o=await t.json(),n=s.querySelector(".weather-error");200===o.cod?(p.className="weather-icon owf",p.classList.add(`owf-${o.weather[0].id}`),q.textContent=`${Math.round(o.main.temp)}°C`,f.textContent=o.weather[0].description,"ru"===localStorage.getItem("lang")?(v.textContent=`Ветер: ${Math.round(o.wind.speed)} м/с`,k.textContent=`Влажность: ${Math.round(o.main.humidity)} %`):(v.textContent=`Wind speed: ${Math.round(o.wind.speed)} m/s`,k.textContent=`Humidity: ${Math.round(o.main.humidity)} %`),n.textContent="",p.style.visibility="visible"):(n.textContent=`Error! ${o.message} for "${_.value}"`,p.style.visibility="hidden",q.textContent="",f.textContent="",v.textContent="",k.textContent="")}_.value="Moscow",window.addEventListener("beforeunload",b),window.addEventListener("load",w),x(),_.addEventListener("change",(()=>{b(),x()}));const C=s.querySelector(".quote"),L=s.querySelector(".author"),I=s.querySelector(".change-quote");async function E(){const e=`../src/data/quotes-${localStorage.getItem("lang")}.json`,t=await fetch(e),o=await t.json();let n=d(19,0);C.textContent=`"${o[n].text}"`,L.textContent=o[n].author}E(),I.addEventListener("click",E);const $=s.querySelector(".play"),A=s.querySelector(".play-next"),D=s.querySelector(".play-prev"),M=s.querySelector(".play-list"),j=new Audio;j.src=e[0].src,j.addEventListener("loadeddata",(()=>{s.querySelector(".song-title").textContent=e[W].title,s.querySelector(".length").textContent=F(j.duration),s.querySelector(".current").textContent=F(j.currentTime),j.volume=.75}));const T=s.querySelector(".progress-bar");function F(e){let t=parseInt(e),o=parseInt(t/60);return t-=60*o,`${o}:${String(t%60).padStart(2,0)}`}T.addEventListener("click",(function(e){const t=window.getComputedStyle(T).width,o=e.offsetX/parseInt(t)*j.duration;j.currentTime=o}));let R=!1,W=0;function G(){j.src=e[W].src,j.play(),R=!0,M.children[W].classList.toggle("play-item__active")}$.addEventListener("click",(function(){$.classList.toggle("pause"),R?(j.pause(),R=!1,M.children[W].classList.toggle("play-item__active")):G()})),A.addEventListener("click",(function(){M.children[W].classList.toggle("play-item__active"),W++,W>3&&(W=0),G()})),D.addEventListener("click",(function(){M.children[W].classList.toggle("play-item__active"),W--,W<0&&(W=3),G()})),e.forEach((e=>function(e){const t=document.createElement("li");t.classList.add("play-item"),t.textContent=e.title,M.append(t)}(e))),M.addEventListener("click",(function(e){R?M.children[W].classList.toggle("play-item__active"):$.classList.toggle("pause");const t=M.querySelectorAll("li");e.target,W=[].indexOf.call(t,e.target),G()})),setInterval((()=>{s.querySelector(".progress-length").style.width=j.currentTime/j.duration*100+"%",s.querySelector(".current").textContent=F(j.currentTime)}),500);const H=s.querySelector(".volume-button");H.addEventListener("click",(()=>{j.muted?(j.muted=!1,H.classList.add("volume-button_on"),H.classList.remove("volume-button_off"),s.querySelector(".volume-percentage").style.width=100*j.volume+"%"):(j.muted=!0,H.classList.remove("volume-button_on"),H.classList.add("volume-button_off"),s.querySelector(".volume-percentage").style.width=0)}));const N=s.querySelector(".volume-slider");N.addEventListener("click",(function(e){const t=window.getComputedStyle(N).width,o=e.offsetX/parseInt(t);j.volume=o,s.querySelector(".volume-percentage").style.width=100*o+"%"})),j.addEventListener("ended",(()=>{M.children[W].classList.toggle("play-item__active"),W++,W>3&&(W=0),G()}));const O=s.querySelector(".settings"),Q=O.querySelector(".settings-btn"),U=O.querySelector(".settings-menu");Q.addEventListener("click",(()=>{U.classList.toggle("settings-menu__hidden")})),window.addEventListener("click",(e=>{let t=e.target;t.closest(".settings")&&"apply-btn"!==t.className||U.classList.add("settings-menu__hidden")}));const X=U.querySelectorAll(".choose-photoSourse input"),Y=U.querySelector(".choose-tag");X.forEach((e=>{e.addEventListener("change",(()=>{"github"!==e.value?Y.classList.remove("choose-tag__hidden"):Y.classList.add("choose-tag__hidden")}))})),window.addEventListener("load",(()=>{U.querySelector("#github").hasAttribute("checked")?Y.classList.add("choose-tag__hidden"):Y.classList.remove("choose-tag__hidden")}));const B={};function P(){"ru"===localStorage.getItem("lang")?(U.querySelector("h4").textContent="Настройки:",U.querySelector(".language_title").textContent="Язык:",U.querySelector(".photo-source_title").textContent="Источник фона:",U.querySelector(".shown-blocks_title").textContent="Отображать блоки:",U.querySelector(".apply-btn").textContent="Применить",U.querySelector(".tag_label").textContent="Тэг",U.querySelector(".time_label").textContent="Время",U.querySelector(".date_label").textContent="Дата",U.querySelector(".greetings_label").textContent="Приветствие",U.querySelector(".quote_label").textContent="Цитата",U.querySelector(".weather_label").textContent="Погода",U.querySelector(".audio_label").textContent="Аудио",U.querySelector(".link_label").textContent="Ссылки",document.querySelector(".name").placeholder="[Введите имя]",document.querySelector(".create-link").textContent="+ Новая ссылка",document.querySelector(".create-btn").textContent="Создать"):(U.querySelector("h4").textContent="Settings",U.querySelector(".language_title").textContent="Language:",U.querySelector(".photo-source_title").textContent="Photo source:",U.querySelector(".shown-blocks_title").textContent="Show bloks:",U.querySelector(".apply-btn").textContent="Apply",U.querySelector(".tag_label").textContent="Tag",U.querySelector(".time_label").textContent="Time",U.querySelector(".date_label").textContent="Date",U.querySelector(".greetings_label").textContent="Greeting",U.querySelector(".quote_label").textContent="Quote",U.querySelector(".weather_label").textContent="Weather",U.querySelector(".audio_label").textContent="Audio-player",U.querySelector(".link_label").textContent="Links",document.querySelector(".name").placeholder="[Enter your name]",document.querySelector(".create-link").textContent="+ New link",document.querySelector(".create-btn").textContent="Create")}U.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(U);B.lang=t.get("lang"),B.photoSourse=t.get("photoSource"),B.tags=t.get("tag"),B.blocks=[];for(const[e,o]of t)"on"===o&&B.blocks.push(e);for(const[e,t]of Object.entries(B))localStorage.setItem(e,t);l(),x(),E(),S(),P(),K(),te(),oe()})),P();let z,J=[];function K(){"ru"===localStorage.getItem("lang")&&U.querySelector("#ru-lang").setAttribute("checked","checked"),"unsplash"===localStorage.getItem("photoSourse")?U.querySelector("#unsplash").setAttribute("checked","checked"):"flickr"===localStorage.getItem("photoSourse")?U.querySelector("#flickr").setAttribute("checked","checked"):"github"===localStorage.getItem("photoSourse")&&U.querySelector("#github").setAttribute("checked","checked"),localStorage.getItem("tags")&&(U.querySelector("#tag").value=localStorage.getItem("tags"));const e=U.querySelector(".choose-shownBlocks"),t=localStorage.getItem("blocks").split(",");z=t,t.forEach((t=>{t&&e.querySelector(`#${t}`).setAttribute("checked","checked")}));let o=e.querySelectorAll("input");o=[].map.call(o,(e=>e.id)),o=o.filter((e=>!t.includes(e))),J=[],o.forEach((t=>{e.querySelector(`#${t}`).removeAttribute("checked"),J.push(t)}))}K();const V=document.querySelector(".links_btn"),Z=document.querySelector(".links_container"),ee=Z.querySelector(".link-creation");function te(){J.forEach((e=>{document.querySelector(`div[data-block='${e}']`).classList.add("block__hidden")}))}function oe(){z.forEach((e=>{document.querySelector(`div[data-block='${e}']`).classList.remove("block__hidden")}))}V.addEventListener("click",(()=>{document.querySelector(".sparrow").classList.toggle("links_container__hidden"),Z.classList.toggle("links_container__hidden")})),window.addEventListener("click",(e=>{e.target.closest(".links")||Z.classList.contains("links_container__hidden")||(Z.classList.add("links_container__hidden"),document.querySelector(".sparrow").classList.add("links_container__hidden"))})),Z.querySelector(".create-link").addEventListener("click",(()=>{ee.style.transform="translate(-220px)"})),Z.querySelector(".back").addEventListener("click",(()=>{ee.style.transform="translate(220px)"})),ee.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(ee);!function(e,t){const o=document.createElement("a");o.textContent=e,o.href=t;const n=document.createElement("li"),r=document.createElement("img");r.src="../src/svg/link-pointer.svg",r.alt="my-link",n.append(r),n.append(o),n.classList.add("opt-link"),Z.querySelector(".link-list").append(n)}(t.get("link-name"),t.get("link-url")),ee.style.transform="translate(220px)"})),te(),oe();const ne=document.querySelector(".google_search");ne.addEventListener("submit",(e=>{e.preventDefault(),location.href=`https://www.google.com/search?q=${ne.querySelector("#link").value}`}))})()})();